<html>
  <head>
    <title>test</title>
  </head>
  <body>
    <script type="text/javascript">
      let readings1 = [
        8190,
        285,
        215,
        249,
        178,
        401,
        395,
        483,
        471,
        475,
        476,
        461,
        472,
        470,
        464,
        464,
        474,
        477,
        471,
        463,
        465,
        467,
        431,
        405,
        434,
        449,
        468,
        470,
        470,
        385,
        323,
        340,
        356,
        355,
        359,
        358,
        359,
        363,
        355,
        438,
        477,
        471,
        486,
        471,
        471,
        467,
        479,
        468,
        457,
        469,
        567,
        8190,
        8191,
        8191,
        8190,
        0,
        8191,
        369,
        356,
        302,
        347,
        468,
        1110,
        8190,
        8190,
        8190,
        8191,
        8191,
        8190,
        8190,
        8191,
        8191,
        8191,
        8190,
        1041,
        849,
        786,
        811,
        960,
        979,
        8191,
        995,
        1023,
        1030,
        1040,
        995,
        1020,
        984,
        1044,
        1024,
        1074,
        937,
        1084,
        1133,
        1106,
        1077,
        1053,
        976,
        1054,
        1098,
        1077,
        8191,
        1072,
        8190,
        8191,
        619,
        8190,
        8190,
        8191,
        8191,
        8190,
        8191,
        8190,
        8190,
        8191,
        8190,
        8191,
        8190,
        8190,
        8190,
        540,
        8190,
        8191,
        8190,
        72,
        8191,
        8191,
        370,
        8190,
        8190,
        8190,
        8190,
        8190,
        497,
        560,
        587,
        639,
        639,
        463,
        376,
        330,
        186,
        186,
        348,
        298,
        289,
        343,
        315
      ];
      let readings2 = [
        212,
        460,
        475,
        283,
        204,
        186,
        465,
        492,
        483,
        479,
        477,
        474,
        461,
        458,
        455,
        469,
        471,
        469,
        470,
        481,
        477,
        475,
        477,
        476,
        484,
        485,
        476,
        472,
        469,
        481,
        474,
        475,
        482,
        479,
        476,
        468,
        479,
        477,
        484,
        479,
        469,
        477,
        477,
        474,
        477,
        406,
        353,
        338,
        346,
        336,
        246,
        196,
        194,
        199,
        203,
        205,
        209,
        213,
        199,
        199,
        200,
        210,
        201,
        202,
        200,
        208,
        202,
        201,
        207,
        204,
        204,
        204,
        206,
        201,
        210,
        209,
        211,
        209,
        212,
        206,
        205,
        211,
        211,
        215,
        210,
        202,
        206,
        200,
        208,
        206,
        210,
        214,
        205,
        203,
        206,
        208,
        202,
        211,
        211,
        210,
        208,
        214,
        213,
        219,
        211,
        212,
        208,
        205,
        215,
        218,
        218,
        214,
        221,
        217,
        216,
        211,
        220,
        214,
        220,
        210,
        219,
        224,
        226,
        226,
        225,
        227,
        227,
        213,
        219,
        219,
        222,
        224,
        221,
        223,
        223,
        221,
        225,
        221,
        218,
        221,
        218,
        225,
        228,
        223,
        223,
        222,
        218,
        222,
        224,
        228,
        221,
        226,
        222,
        219,
        218,
        225,
        219,
        220,
        226,
        226,
        223,
        222,
        226,
        220,
        222,
        217,
        224,
        224,
        218,
        216,
        217,
        217,
        219,
        218,
        220,
        228,
        219,
        215,
        216,
        218,
        220,
        223,
        221,
        218,
        223,
        217,
        221,
        221,
        224,
        225,
        225,
        229,
        227,
        233,
        228,
        226,
        228,
        225,
        224,
        225,
        232,
        227,
        223,
        224,
        231,
        226,
        228,
        228,
        231,
        229,
        230,
        223,
        229,
        231,
        229,
        220,
        226,
        225,
        227,
        227,
        226,
        232,
        224,
        221,
        224,
        223,
        211,
        206,
        224,
        227,
        216,
        227,
        223,
        224,
        229,
        225,
        224,
        224,
        224,
        228,
        224,
        227,
        224,
        227,
        225,
        228,
        223,
        220,
        217,
        224,
        221,
        222,
        217,
        223,
        226,
        225,
        219,
        221,
        226,
        225,
        224,
        220,
        223,
        224,
        220,
        231,
        222,
        229,
        228,
        225,
        229,
        225,
        224,
        225,
        227,
        230,
        232,
        226,
        227,
        227,
        228,
        228,
        230,
        234,
        244,
        418,
        441,
        458,
        468,
        478,
        478,
        472,
        471,
        482,
        479,
        495,
        495,
        484,
        482,
        477,
        481,
        487,
        476,
        477,
        476,
        490,
        490,
        478,
        477,
        475,
        442,
        487,
        490,
        363,
        234,
        238,
        234,
        231,
        233,
        232,
        238,
        239,
        236,
        236,
        238,
        237,
        245,
        235,
        236,
        238,
        237,
        233,
        230,
        226,
        230,
        231,
        228,
        237,
        236,
        227,
        230,
        234,
        232,
        232,
        231,
        236,
        234,
        233,
        239,
        235,
        242,
        238,
        235,
        299,
        470,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        8190,
        255,
        588,
        244,
        444,
        367,
        466,
        456,
        247,
        245,
        250,
        243,
        249,
        249,
        255,
        247,
        252,
        250,
        248,
        254,
        250,
        241,
        242,
        247,
        243,
        251,
        245,
        249,
        250,
        249,
        244,
        245,
        254,
        238,
        240,
        237,
        238,
        243,
        242,
        241,
        246,
        244,
        245,
        242,
        252,
        246,
        244,
        238,
        248,
        422,
        419,
        418,
        281,
        263
      ];
      class SensorState {
        latest_distance_mm = -1;
        last_update_timestamp = -1;
        RANGE_SENSITIVITY = 150;
        READING_TIMEOUT_SECONDS = 3600;
        constructor() {}
        has_sensor_changed(reading) {
          if (
            Math.abs(reading - this.latest_distance_mm) >=
            this.RANGE_SENSITIVITY
          ) {
            this.latest_distance_mm = reading;
            this.last_update_timestamp = Date.now();
            return true;
          }
          return false;
        }
        is_active() {
          return (
            this.latest_distance_mm < 2000 &&
            Date.now() - this.last_update_timestamp <
              this.READING_TIMEOUT_SECONDS
          );
        }
        /**
         *
         * This gives us a range in centimeters which is a bit easier to deal with, and more consistent.
         *
         **/
        cm_distance_range() {}
      }

      let sensorState = new SensorState();
      for (reading of readings2) {
        if (sensorState.has_sensor_changed(reading)) {
          if (!sensorState.is_active()) {
            console.info("Sensor is out of range.");
          }
          console.info(
            "Updating IoT with new range",
            sensorState.latest_distance_mm
          );
        }
      }
    </script>
  </body>
</html>
